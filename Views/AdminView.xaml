<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="bobesponja2._0.Views.AdminView"
             x:Name="adminPage"
             BackgroundImageSource="back3.png">
    <ScrollView>
        <StackLayout>
            <!-- Cabeçalho -->
            <Label Text="Painel do Administrador" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" TextColor="White"/>

            <!-- Nome do usuario admin logado -->
            <StackLayout Padding="10"/>
            <Frame BackgroundColor="Transparent" BorderColor="White" CornerRadius="10" Padding="15" Margin="10">
                <StackLayout Orientation="Horizontal">
                    <Label Text="Administrador:" 
                           FontSize="16" 
                           TextColor="White" 
                           VerticalOptions="Center"/>
                    <Label Text="{Binding NomeUsuarioLogado}" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="White" 
                           VerticalOptions="Center"/>
                    <Button Text="Sair" 
                            Command="{Binding LogoutCommand}"
                            BackgroundColor="Red"
                            TextColor="White"
                            CornerRadius="5"
                            HorizontalOptions="EndAndExpand"
                            Padding="10,5"/>
                </StackLayout>
            </Frame>

            <!-- Campos input -->
            <StackLayout Padding="10"/>
            <Label Text="Nome do Item" FontAttributes="Bold" TextColor="White"/>
            <Entry Text="{Binding Nome}" WidthRequest="350"/>

            <StackLayout Padding="10"/>
            <Label Text="Descrição" FontAttributes="Bold" TextColor="White"/>
            <Entry Text="{Binding Descricao}" WidthRequest="350"/>

            <StackLayout Padding="10"/>
            <Picker Title="Status do Item" TextColor="White" TitleColor="White" ItemsSource="{Binding StatusItem}" SelectedItem="{Binding Status, Mode=TwoWay}" />

            <StackLayout Padding="10"/>
            <Label Text="Preço" FontAttributes="Bold" TextColor="White"/>
            <Entry Text="{Binding Preco}" WidthRequest="350"/>

            <!-- Botões -->
            <StackLayout Padding="20"/>
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                <Button Text="Cadastrar" 
                        Command="{Binding AdicionarCommand}" 
                        BackgroundColor="Red" 
                        TextColor="White" 
                        WidthRequest="110"/>
                <Button Text="Atualizar" 
                        Command="{Binding AtualizarCommand}" 
                        BackgroundColor="Green" 
                        TextColor="White" 
                        WidthRequest="110"/>
                <Button Text="Limpar" 
                        Command="{Binding LimparCamposCommand}" 
                        BackgroundColor="Gray" 
                        TextColor="White" 
                        WidthRequest="110"/>
            </HorizontalStackLayout>

            <!-- Lista de itens -->
            <StackLayout Padding="20"/>
            <Label Text="Itens Cadastrados" FontAttributes="Bold" FontSize="20" TextColor="White" HorizontalOptions="Center"/>

            <CollectionView ItemsSource="{Binding Itens}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10" 
                               Margin="5"  
                               BorderColor="White" 
                               CornerRadius="12">
                            <VerticalStackLayout>
                                <Label Text="{Binding Nome}" 
                                       FontSize="18" 
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label Text="{Binding Descricao}" 
                                       FontSize="14" 
                                       TextColor="White"/>
                                
                                <StackLayout Orientation="Horizontal" Margin="0,5">
                                    <Label Text="Preço:" 
                                           FontSize="14" 
                                           TextColor="White"/>
                                    <Label Text="{Binding Preco}" 
                                           FontSize="14" 
                                           FontAttributes="Bold"
                                           TextColor="White"/>
                                </StackLayout>
                                
                                <StackLayout Orientation="Horizontal" Margin="0,5">
                                    <Label Text="Status:" 
                                           FontSize="14" 
                                           TextColor="White"/>
                                    <Label Text="{Binding Status}" 
                                           FontSize="14" 
                                           TextColor="White"/>
                                </StackLayout>
                                
                                <HorizontalStackLayout Spacing="10" Margin="0,10,0,0">
                                    <Button Text="Editar" 
                                            Command="{Binding Source={x:Reference Name=adminPage}, Path=BindingContext.SelecionarParaEdicaoCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Blue" 
                                            TextColor="White"
                                            WidthRequest="120"/>
                                    <Button Text="Excluir" 
                                            Command="{Binding Source={x:Reference Name=adminPage}, Path=BindingContext.ExcluirItemCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Red" 
                                            TextColor="White"
                                            WidthRequest="120"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                
                <CollectionView.EmptyView>
                    <Label Text="Nenhum item cadastrado" 
                           FontSize="16" 
                           HorizontalOptions="Center"
                           TextColor="White"
                           Margin="20"/>
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Botão historico -->
            <StackLayout Padding="20"/>
            <Button Text="Ver Histórico de Seleções" 
                    Command="{Binding CarregarHistoricoCommand}" 
                    BackgroundColor="Purple" 
                    TextColor="White" 
                    WidthRequest="350"/>

            <!-- Historico, se visivel -->
            <StackLayout IsVisible="{Binding HistoricoVisivel}">
                <StackLayout Padding="20"/>
                <Label Text="Histórico de Seleções dos Clientes"    
                       FontSize="18" 
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       Margin="0,0,0,15"/>

                <CollectionView ItemsSource="{Binding Historico}" 
                                MaximumHeightRequest="300"
                                Margin="10,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="15" 
                                   Margin="5" 
                                   BorderColor="Purple" 
                                   CornerRadius="8"
                                   BackgroundColor="#1a1a1a">
                                <VerticalStackLayout Spacing="5">
                                    <StackLayout Orientation="Horizontal">
                                        <Label Text="Cliente:" 
                                               FontSize="14" 
                                               TextColor="White"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding NomeUsuario}" 
                                               FontSize="14" 
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalOptions="Center"
                                               Margin="5,0,0,0"/>
                                    </StackLayout>
                                    
                                    <StackLayout Orientation="Horizontal">
                                        <Label Text="Item:" 
                                               FontSize="14" 
                                               TextColor="White"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding NomeItem}" 
                                               FontSize="14" 
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               VerticalOptions="Center"
                                               Margin="5,0,0,0"/>
                                    </StackLayout>
                                    
                                    <Label Text="{Binding DataHora, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                           FontSize="12" 
                                           TextColor="LightGray"
                                           HorizontalOptions="End"
                                           Margin="0,5,0,0"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    
                    <CollectionView.EmptyView>
                        <Label Text="Nenhuma seleção registrada ainda" 
                               FontSize="14" 
                               HorizontalOptions="Center"
                               TextColor="White"
                               Margin="20"/>
                    </CollectionView.EmptyView>
                </CollectionView>
            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>